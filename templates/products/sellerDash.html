{% extends "products/ecommBase.html" %}
{% load static %}
{% block style %}




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap4.min.css">
<link href="{% static 'css/addProduct.css' %}" rel="stylesheet" />
    <script src=
"https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js">
    </script>
    <script src=
"https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.js">
    </script>
    <link href=
"http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/ui-lightness/jquery-ui.css"
          rel="stylesheet" type="text/css" />
        <link href=
    {% static "colorpicker-master/jquery.colorpicker.css"  %}
          rel="stylesheet" type="text/css" />
    <style>
  .form-group .form-control {
    display: block !important;
  }

  .chosen-container {
    display: none;
  }
td.sorting_1 {
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
}
  .dot {
    height: 15px;
    width: 15px;
         margin-bottom: 4px;
    margin-right: -2px;
    border : 1px solid black;
    border-radius: 50%;
    display: inline-block;
  }
  [type='color'] {
  -moz-appearance: none;
  -webkit-appearance: none;
  appearance: none;
  padding: 0;
  width: 75px;
  height: 25px;
  border: none;
}

[type='color']::-webkit-color-swatch-wrapper {
  padding: 0;
}

[type='color']::-webkit-color-swatch {
  border: none;
}

.color-picker {
  padding: 10px 15px;
  border-radius: 10px;
  border: 1px solid #ccc;
  background-color: #f8f9f9;
}
</style>
{% endblock %}
{% block content %}
{% if messages %}
{% for message in messages %}
<div class="alert alert-{{ message.tags }} alert-dismissible fade show mt-3" role="alert">
  <strong id="g_msg">Message : {{message}} </strong>
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>


{% endfor %}

{% endif %}


<section class="container p-3">
  <div class="d-flex justify-content-end my-2">
    <button class="btn btn-info" id="addProductOpen"><i class="fa fa-plus"> </i>&nbsp;Add Product</button>
  </div>
  <table id="example" class="table table-striped table-bordered dt-responsive nowrap" style="width:100%">
    <thead>
      <tr>

        <th>Name</th>
        <th>Price</th>

        <th>Quantity</th>
        <th>Category</th>
        <th>Image</th>
        <th>Size.</th>
        <th>Color</th>
        <th>Created Date</th>

        <th>Actions </th>
          <th>Offer Price</th>
        <th>Description</th>

      </tr>
    </thead>
    <tbody>
      {% for item in my_products %}
      <tr>

        <td>{{ item.name }}</td>
        <td>{{  item.price }} $</td>

        <td>{{ item.quantity }}</td>
        <td>{{  item.item_category }}</td>

        <td><img src="{{ item.image.url }}" width="60" /></td>
        <td>
          {% if item.get_size|length > 0 %}
          {% for size in item.get_size %}
          {{ size }}
          {% endfor %}
          {% else %}
          No Size Added
          {% endif %}
        </td>
        <td class="sorting_1">
          {% if item.get_color|length > 0 %}
          {% for color in item.get_color %}
          <span class="dot" style="background-color: {{ color }}"></span>
          {% endfor %}
          {% else %}
          No Color Added
          {% endif %}
        </td>
        <td>{{ item.created_at }}</td>

        <td>

          <a class="btn btn-warning editProduct" id="editproduct_{{ item.pk }}" style="padding: 2px 10px"><i class="fa fa-edit" > </i></a>
          <a href="{% url 'deleteProduct' item.pk %}" class="btn btn-danger " style="padding: 2px 10px"> <i
              class="fa fa-trash"> </i></a>

        </td>
        <td>{{  item.offer_price }} $</td>
        <td>
          <p>
            {{ item.description }}
          </p>
        </td>

      </tr>
      {% endfor %}
    </tbody>
  </table>
</section>

<div class="modal fade" tabindex="-1" id="addProductDiv">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"> Add Product</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="product__main">
          <div class="container-fluid">

            <form action="{% url 'addProduct' %}" method="post" enctype="multipart/form-data" class="product__form">
              {% csrf_token %}
              <div class="row">

                <div class="col-6">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Product Name</label>
                    <input type="text" class="form-control" name="name" aria-describedby="emailHelp">
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Product Price</label>
                    <input type="text" class="form-control" placeholder="USD" name="price"
                      aria-describedby="emailHelp">
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Offer Price</label>
                    <input type="text" class="form-control" placeholder="USD" name="offer"
                      aria-describedby="emailHelp">
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Product Quantity</label>
                    <input type="number" class="form-control" name="quantity" aria-describedby="emailHelp">
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Product Description</label>
                    <textarea rows="5" cols="15" class="form-control" name="description"></textarea>
                  </div>
                </div>

                     <div class="col-6 ">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Product Serial No</label>
                    <input type="text" class="form-control" name="serial_no" aria-describedby="emailHelp">
                  </div>
                </div>
                     <div class="col-6 ">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Product Rating</label>
                    <select name="rating" class="form-control">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                  </div>
                </div>

                <div class="col-12">
                  <div class="form-group">

                    <label for="catid">Product Category</label>

                    <select class="form-control" id="catid" name="category" style="display: inherit;">
                      {% for category in all_categories %}
                      <option value="{{ category.id }}">{{ category.name }}</option>
                      {% endfor %}
                    </select>

                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group my-2">
                    <label for="exampleInputEmail1"> Product Sizes Available</label>
                    <div class="d-flex align-items-center">
                      <div class="size-list w-100">
                        <div class="d-flex">
                          <select name="size[]" class="form-control mb-2">

                            <option value="s">s</option>
                            <option value="m">m</option>
                            <option value="l">l</option>
                              <option value="No_Size">No Size</option>
                          </select>
                          <div class="add__button">
                            <button type="button" class="btn btn-success btn-sm btn-add-size"><span class="fa fa-plus"></span>
                              </button>
                          </div>
                        </div>
                      </div>
  
                      
                    </div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group my-2">
                    <label for="exampleInputEmail1"> Product Colors Available</label>
                    <div class="d-flex align-items-center">
                      <div class="color-list w-100">
                        <div class="d-flex ">

<span class="color-picker"><input type="color" name="color[]" class="form-control colorPicker"  id="my_color_picker" />
</span>
                          <div class="add__button">
                            <button type="button" class="btn btn-success btn-sm btn-add-color"><span class="fa fa-plus"></span>
                              </button>
                          </div>
                        </div>
                      </div>
  
                      
                    </div>
                  </div>
                </div>
                <div class="col-12 browser__img" >
                  <div class="form-group">
                    <input type="file" id="file" class="input-file" name="image">
                    <label for="file" class="btn btn-tertiary js-labelFile">
                      <i class="icon fa fa-check"></i>
                      <span class="js-fileName">Choose a file (Please Prefer JPG or JPEG Image to Upload)</span>
                    </label>
                  </div>
                  
                </div>
                <div class="col-12 d-flex justify-content-center">
                  <button type="submit" class="btn btn-primary " style="width: 40%;">Save Product</button>
                </div>
              </div>
              
            </form>

          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        
      </div>
    </div>
  </div>
</div>

<div class="modal fade" tabindex="-1" id="editProductDiv">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"> Edit Product</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="product__main">
          <div class="container-fluid" id="edit-form">


          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

      </div>
    </div>
  </div>
</div>








<div class="modal fade" tabindex="-1" id="CategoryModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Category</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <h5>Category Name</h5>
          <input type="text" name="category" id="category">
        </form>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="save_category">Save</button>
      </div>
    </div>
  </div>
</div>



{% endblock content %}
{% block jsfiles %}







<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap4.min.js"></script>
       <script src=
"{% static 'colorpicker-master/jquery.colorpicker.js' %}">
    </script>

<script>
  $(document).on('click','.editProduct',function (){
      var id = $(this).attr('id').slice(12,)

       $.ajax({
          url: "/products/getProduct/"+id,

          success: function(data) {
             if(data.msg = 'success'){
                item = JSON.parse(data.item)
                console.log(item[0].fields.name)
$("#edit-form").empty()
                categories = JSON.parse(data.categories)
                 console.log(categories)
                 $("#edit-form").append(
                     `
                      <form  method="post" action="/products/updateProduct/${id}/" enctype="multipart/form-data" class="product__form">
              {% csrf_token %}
              <div class="row">
                <div class="col-6">
                  <div class="form-group">
                    <label for="">Product Name</label>
                    <input type="text" class="form-control" value=${item[0].fields.name} id="editName" name="name" aria-describedby="">
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Product Price</label>
                    <input type="text" class="form-control" value=${item[0].fields.price} id="editPrice" placeholder="USD" name="price"
                      aria-describedby="emailHelp">
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Offer Price</label>
                    <input type="text" class="form-control" id="offerPrice" value=${item[0].fields.offer_price} placeholder="USD" name="offer"
                      aria-describedby="emailHelp">
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Product Quantity</label>
                    <input type="number" class="form-control" id="productQuantity" value=${item[0].fields.quantity} name="quantity" aria-describedby="emailHelp">
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Product Description</label>
                    <textarea rows="5" cols="15" class="form-control" id="productDesc"  name="description">${item[0].fields.description}</textarea>
                  </div>
                </div>


                     <div class="col-6 ">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Product Serial No</label>
                    <input type="text" class="form-control" name="serial_no" value="${item[0].fields.serial_no}" aria-describedby="emailHelp">
                  </div>
                </div>
                     <div class="col-6 ">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Product Rating</label>
                    <select name="rating" class="form-control">
                        <option value="1" ${
                        item[0].fields.rating == 1 ? 'selected':''
                     }>1</option>
                        <option value="2" ${
                        item[0].fields.rating == 2 ? 'selected':''
                     }>2</option>
                        <option value="3" ${
                        item[0].fields.rating == 3 ? 'selected':''
                     }>3</option>
                        <option value="4" ${
                        item[0].fields.rating == 4 ? 'selected':''
                     }>4</option>
                        <option value="5" ${
                        item[0].fields.rating == 5 ? 'selected':''
                     }>5</option>
                    </select>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-group">

                    <label for="catid">Product Category</label>

                    <select class="form-control" id="catid" name="category" style="display: inherit;" >
                      ${
                            categories.map((item1,index)=>{
                                return(
                                    `
                                        <option value="${item1.pk}" ${ item1.pk == item[0].fields.item_category? 'selected' : '' }

                                            >${item1.fields.name}</option>
                                    `
                                )
                            }).join('')
                     }


                    </select>

                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group my-2">
                    <label for="exampleInputEmail1"> Product Sizes Available</label>
                    <div class="d-flex align-items-center">
                      <div class="size-list w-100">
                      ${
                            data.sizes.length == 0 ? `
                             <div class="d-flex size-input">
                                      <select name="size[]" class="form-control mb-2">
                                        <option value="s" ${ item == 's' ? 'selected' : '' }>s</option>
                                        <option value="m" ${ item == 'm' ? 'selected' : '' }>m</option>
                                        <option value="l" ${ item == 'l' ? 'selected' : '' }>l</option>
                                         <option value="No_Size " ${ item == '' ? 'selected' : '' }>No Size</option>
                                      </select>
                            <div class="add__button">
                                        <button type="button" class="btn btn-success btn-sm btn-add-size"><span class="fa fa-plus"></span>
                                          </button>
                                      </div>
                                      </div>
                            `:``
                     }
                       ${
                         data.sizes.map((item,index)=>{
                             return(

                                   `
                                      <div class="d-flex size-input">
                                      <select name="size[]" class="form-control mb-2">
                                        <option value="s" ${ item == 's' ? 'selected' : '' }>s</option>
                                        <option value="m" ${ item == 'm' ? 'selected' : '' }>m</option>
                                        <option value="l" ${ item == 'l' ? 'selected' : '' }>l</option>
<option value="No_Size " ${ item == '' ? 'selected' : '' }>No Size</option>
                                      </select>
                                        ${ index == 0 ?
                                                `
                                                <div class="add__button">
                                        <button type="button" class="btn btn-success btn-sm btn-add-size"><span class="fa fa-plus"></span>
                                          </button>
                                      </div>
                                                `

                                   :`
                                        <div class="add__button close__button">
                  <button type="button" class="btn btn-danger btn-remove-size" ><span class="fas fa-minus"></span></span>
                    </button>
                </div>
                                   `}

                                    </div>
                                   `

                             )
                         }).join('')
                     }

                      </div>


                    </div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group my-2">
                    <label for="exampleInputEmail1"> Product Colors Available</label>
                    <div class="d-flex align-items-center">
                      <div class="color-list w-100">
                      ${
                            data.colors.length == 0 ? `
                            <div class="d-flex color-input">
                          <input type="text" name="color[]" value="${item}" class="form-control" />
                         <div class="add__button">

                            <button type="button" class="btn btn-success btn-sm btn-add-color"><span class="fa fa-plus"></span>
                              </button>
                          </div>
    </div>
                            `:``
              }
                      ${
                        data.colors.map((item,index)=>{
                            return(
                                `
                                <div class="d-flex color-input">
                         <span class="color-picker"> <input type="color" name="color[]" value="${item}" class="form-control colorPicker" /></span>
                          ${ index == 0 ?
                                                `
                                                 <div class="add__button">

                            <button type="button" class="btn btn-success btn-sm btn-add-color"><span class="fa fa-plus"></span>
                              </button>
                          </div>
                                                `

                                   :`
                                      <div class="add__button close__button">
          <button type="button" class="btn btn-danger btn-remove-color"><span class="fas fa-minus"></span>
            </button>
        </div>
                                   `}

                        </div>
                                `
                            )
                        }).join('')
                     }

                      </div>


                    </div>
                  </div>
                </div>

                <div class="col-4 browser__img" >
                  <div class="form-group">

                     <img id="blah" src="/media/${item[0].fields.image}" width="100"/>

                  </div>

                </div>
                <div class="col-8 browser__img" >
                 <div >

                    <input id="file-upload" name="image" type="file" onchange="readURL(this);" />

                </div>

                </div>
                <div class="col-12 d-flex justify-content-center">

                  <button type="submit" class="btn btn-primary " style="width: 40%;">Save Product</button>
                </div>
              </div>

            </form>

                     `
                 )
             $("#editProductDiv").modal('toggle')
            }
          },
          error: function(data)
          {
            alert("error occured");
          }
        });

  })
  $(document).ready(function () {
    $('#example').DataTable({
      'responsive': true,
      'scrollX': true
    });
  });


  $("#addProductOpen").click(function () {
    $("#addProductDiv").modal('toggle')
  })
  $("#addNewCategory").click(function (e) {
    e.preventDefault()
    $("#CategoryModal").modal('toggle')
  })
  $("#save_category").click(function (e) {
    $.post("{% url 'addCategory' %}", {
        category: $("#category").val()

      },
      function (data, status) {

      });
  })


  $(function () {

    $(document.body).on('click', '.changeType', function () {
      $(this).closest('.phone-input').find('.type-text').text($(this).text());
      $(this).closest('.size-input').find('.type-input').val($(this).data('type-value'));
    });

    $(document).on('click', '.btn-remove-size', function () {
      $(this).closest('.size-input').remove();
    });
    $(document).on('click', '.btn-remove-color', function () {
        console.log('remove color')
      $(this).closest('.color-input').remove();
    });



    $(document).on('click','.btn-add-size',function (){
        console.log("add size")
      var index = $('.size-input').length + 1;

      $('.size-list').append(
        `
						<div class="d-flex size-input" >


							<select name="size[]" class="form-control mb-2"  >
                            <option value="s">s</option>
                            <option value="m">m</option>
                            <option value="l">l</option>
<option value="No_Size ">No Size</option>
                        </select>
                <div class="add__button close__button">
                  <button type="button" class="btn btn-danger btn-remove-size" ><span class="fas fa-minus"></span></span>
                    </button>
                </div>
						</div>
						`
      );

    });
    $(document).on('click','.btn-add-color',function (){

      var index = $('.color-input').length + 1;

      
      $(".color-list").append(`
      <div class="d-flex color-input">

<span class="color-picker"><input type="color" name="color[]" class="form-control colorPicker" /></span>
        <div class="add__button close__button">
          <button type="button" class="btn btn-danger btn-remove-color"><span class="fas fa-minus"></span>
            </button>
        </div>
      </div>
        `)

    });
  });

  (function() {
  
    'use strict';
  
    $('.input-file').each(function() {
      var $input = $(this),
          $label = $input.next('.js-labelFile'),
          labelVal = $label.html();
      
     $input.on('change', function(element) {
        var fileName = '';
        if (element.target.value) fileName = element.target.value.split('\\').pop();
        fileName ? $label.addClass('has-file').find('.js-fileName').html(fileName) : $label.removeClass('has-file').html(labelVal);
     });
    });
  
  })();
 function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $('#blah')
                        .attr('src', e.target.result)
                        .width(150)
                        .height(150);
                };

                reader.readAsDataURL(input.files[0]);
            }
        }

           $(document).ready(function () {

            $('#my_color_picker').colorpicker({
                color: '#000',
                onShow: function (colpkr) {
                    $(colpkr).fadeIn(500);
                    return false;
                },
                onHide: function (colpkr) {
                    $(colpkr).fadeOut(500);
                    return false;
                },
                onChange: function (hsb, hex, rgb) {
                    $('#my_color_picker').css('backgroundColor', '#' + hex);
                }
            });
            //            $('#<%=txtReserveType.ClientID %>')
        });
 $(document).on('change','.colorPicker',function(){
    newVal = this.value;
    console.log(newVal)
    this.value = newVal
    console.log(this.value)
})
</script>
{% endblock jsfiles %}